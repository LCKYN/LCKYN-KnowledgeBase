---
id: 74.02
tags: [type/concept, status/evergreen, context/dev-tools]
---

# pre-commit

## Overview
pre-commit is a Python framework for managing and maintaining multi-language Git hooks. It automates code quality checks before commits, ensuring consistent standards across teams without manual intervention.

## Installation
```bash
pip install pre-commit
```

## Quick Start
```bash
# Create config file
pre-commit sample-config > .pre-commit-config.yaml

# Install hooks
pre-commit install

# Run against all files (first time)
pre-commit run --all-files
```

## Configuration
`.pre-commit-config.yaml` at repo root:

```yaml
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
```

## Common Hooks

### General Purpose
```yaml
- repo: https://github.com/pre-commit/pre-commit-hooks
  rev: v4.5.0
  hooks:
    - id: trailing-whitespace
    - id: end-of-file-fixer
    - id: check-yaml
    - id: check-json
    - id: check-toml
    - id: check-merge-conflict
    - id: check-added-large-files
      args: ['--maxkb=1000']
    - id: detect-private-key
    - id: no-commit-to-branch
      args: ['--branch', 'main']
```

### Python
```yaml
- repo: https://github.com/astral-sh/ruff-pre-commit
  rev: v0.3.0
  hooks:
    - id: ruff
      args: ['--fix']
    - id: ruff-format

- repo: https://github.com/pre-commit/mirrors-mypy
  rev: v1.8.0
  hooks:
    - id: mypy
      additional_dependencies: [types-requests]
```

### JavaScript/TypeScript
```yaml
- repo: https://github.com/pre-commit/mirrors-eslint
  rev: v8.56.0
  hooks:
    - id: eslint
      files: \.[jt]sx?$
      additional_dependencies:
        - eslint
        - typescript

- repo: https://github.com/pre-commit/mirrors-prettier
  rev: v4.0.0-alpha.8
  hooks:
    - id: prettier
```

### Conventional Commits
```yaml
- repo: https://github.com/compilerla/conventional-pre-commit
  rev: v3.1.0
  hooks:
    - id: conventional-pre-commit
      stages: [commit-msg]
```

## Hook Configuration Options

| Option | Description |
|--------|-------------|
| `id` | Hook identifier |
| `name` | Display name (optional) |
| `args` | CLI arguments |
| `files` | Regex for files to include |
| `exclude` | Regex for files to exclude |
| `types` | File types (e.g., `[python]`) |
| `stages` | When to run (`commit`, `push`, `commit-msg`) |
| `additional_dependencies` | Extra packages to install |
| `language_version` | Specific runtime version |

## Commands

| Command | Description |
|---------|-------------|
| `pre-commit install` | Install hooks |
| `pre-commit install --hook-type commit-msg` | Install commit-msg hook |
| `pre-commit run --all-files` | Run on all files |
| `pre-commit run <hook-id>` | Run specific hook |
| `pre-commit autoupdate` | Update hook versions |
| `pre-commit clean` | Clear cache |
| `pre-commit uninstall` | Remove hooks |

## Stages

```yaml
hooks:
  - id: my-hook
    stages: [commit]  # default
```

| Stage | Trigger |
|-------|---------|
| `commit` | Before commit (default) |
| `commit-msg` | Validate commit message |
| `push` | Before push |
| `pre-merge-commit` | Before merge commit |
| `manual` | Only with `--hook-stage manual` |

## Local Hooks
Define custom hooks without external repos:

```yaml
- repo: local
  hooks:
    - id: pytest
      name: Run pytest
      entry: pytest tests/ -v
      language: system
      pass_filenames: false
      always_run: true

    - id: check-migrations
      name: Check Django migrations
      entry: python manage.py makemigrations --check --dry-run
      language: system
      pass_filenames: false
      types: [python]
```

## CI Integration

### GitHub Actions
```yaml
- uses: pre-commit/action@v3.0.0
```

### GitLab CI
```yaml
pre-commit:
  stage: lint
  image: python:3.11
  script:
    - pip install pre-commit
    - pre-commit run --all-files
```

## Full Python Example
```yaml
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.3.0
    hooks:
      - id: ruff
        args: ['--fix']
      - id: ruff-format

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy

  - repo: https://github.com/compilerla/conventional-pre-commit
    rev: v3.1.0
    hooks:
      - id: conventional-pre-commit
        stages: [commit-msg]

  - repo: local
    hooks:
      - id: pytest
        name: pytest
        entry: pytest tests/ --tb=short
        language: system
        pass_filenames: false
        always_run: true
```

## Best Practices
1. **Pin versions**: Always specify `rev` for reproducibility
2. **Run `autoupdate`**: Periodically update hook versions
3. **Start minimal**: Add hooks incrementally
4. **CI enforcement**: Run in CI as safety net
5. **Document skipping**: Use `SKIP=hook-id git commit` sparingly

## Skipping Hooks
```bash
# Skip all hooks
git commit --no-verify

# Skip specific hooks
SKIP=ruff,mypy git commit -m "wip"
```

## Related Concepts
- [[74.01 Conventional Commits]] - Commit message standards
- [[73.02 Docker]] - CI/CD integration

## References
- [pre-commit Documentation](https://pre-commit.com/)
- [Supported Hooks](https://pre-commit.com/hooks.html)
- [pre-commit GitHub](https://github.com/pre-commit/pre-commit)
