---
id: 71.04
tags: [type/concept, status/evergreen, context/python, context/dev-tools]
---

# Google Python Style Guide

## Overview
Google's internal Python style guide — a set of conventions covering **language rules** (what to use/avoid) and **style rules** (formatting, naming, docs). Widely adopted in industry as a de facto standard beyond Google.

> [!INFO] Tooling
> Use **Black** or **Pyink** as auto-formatter. Use **pylint** with [Google's pylintrc](https://google.github.io/styleguide/pylintrc) for linting. Use **pytype** for static type checking.

---

## Section 2 — Language Rules

### Imports
- `import x` for packages/modules only — not for individual classes, functions, or types
- `from x import y` where `x` is the package and `y` is the module
- `from x import y as z` only when there's a name collision or `y` is inconveniently long
- `import y as z` only for standard abbreviations (e.g., `import numpy as np`)
- **No relative imports** — always use full package path

```python
# Yes
from absl import flags
from sound.effects import echo

# No
import jodie          # ambiguous — which jodie?
from . import sibling # no relative imports
```

### Exceptions
- Use built-in exception classes where appropriate (`ValueError`, `TypeError`, etc.)
- Custom exceptions must inherit from an existing class; name must end in `Error`
- **Never** catch bare `except:` or `Exception` unless re-raising or at isolation boundary
- Keep `try` blocks minimal
- **Do not use `assert` as runtime validation** — only in tests (pytest) or non-critical checks

### Mutable Global State
- Avoid mutable module-level state
- Module-level **constants** are encouraged — name with `ALL_CAPS_UNDER`
- Mutable globals must be prefixed with `_` (internal) and accessed via public functions

### Comprehensions & Generators
- ✅ Simple single-clause comprehensions
- ❌ Multiple `for` clauses or complex filter chains — use a regular `for` loop instead

```python
# Yes
result = [f(x) for x in items if condition(x)]

# No
result = [(x, y) for x in range(10) for y in range(5) if x * y > 10]
```

### Lambda Functions
- Allowed for simple one-liners only (< 60–80 chars)
- Prefer `operator.mul` over `lambda x, y: x * y` for common operations
- If multi-line → use a nested `def` instead

### Default Argument Values
- **Never use mutable defaults** — use `None` and assign inside the function

```python
# Yes
def foo(a, b: list | None = None):
    if b is None:
        b = []

# No
def foo(a, b=[]):  # shared across all calls!
```

### True/False Evaluation
- Prefer implicit falsy checks: `if seq:` not `if len(seq) == 0:`
- Always use `is None` / `is not None` to check for `None`
- Never compare booleans with `==`: use `if not x:` not `if x == False:`
- Exception: integers — use explicit `== 0` to avoid `None` confusion
- NumPy arrays: use `.size` not implicit bool

### Decorators
- Use judiciously when there's a clear advantage
- Avoid `@staticmethod` — prefer module-level functions
- Use `@classmethod` only for named constructors or class-level cache management

### Type Annotations (2.21)
- Strongly encouraged for public APIs
- Use **pytype** in build system for static checking
- Annotate code that is prone to type errors or hard to understand

### Power Features
- **Avoid**: metaclasses, bytecode manipulation, dynamic inheritance, `__del__`, `getattr` hacks
- Standard library use of these (e.g., `dataclasses`, `abc.ABCMeta`, `enum`) is fine

---

## Section 3 — Style Rules

### Formatting

| Rule | Detail |
|---|---|
| **Line length** | 80 chars max; exceptions for URLs, long imports, pylint disables |
| **Indentation** | 4 spaces — never tabs |
| **Line continuation** | Use implicit joining inside `()`, `[]`, `{}` — no backslash `\` |
| **Semicolons** | Never |
| **Blank lines** | 2 between top-level defs; 1 between methods |
| **Statements per line** | One — except simple `if foo: bar()` without `else` |
| **Trailing commas** | Add when closing bracket is on its own line (helps Black) |

### Whitespace
- No spaces inside `()`, `[]`, `{}`
- No space before `,`, `;`, `:`
- No space before `(` in function calls or index access
- No trailing whitespace
- No spaces around `=` in keyword args — **unless** a type annotation is present

```python
# Yes
def f(a: int = 0): ...
def g(a=0): ...

# No
def f(a:int=0): ...
def g(a = 0): ...
```

### Strings
- Pick `'` or `"` and be consistent within a file
- Use `"""` for multi-line strings and all docstrings
- Prefer f-strings for formatting; `%` and `.format()` also allowed
- **Don't concatenate in a loop with `+`** — use a list + `''.join()` or `io.StringIO`
- For logging: use `%`-style patterns as the first arg, **not** f-strings

```python
# Yes (logging)
logging.info('Value is: %s', value)

# No
logging.info(f'Value is: {value}')  # renders even if not logged
```

### Imports Ordering
Group imports from most generic → least generic, lexicographically sorted within each group:

```python
# 1. __future__
from __future__ import annotations

# 2. Standard library
import os
import sys

# 3. Third-party
import numpy as np
import tensorflow as tf

# 4. Internal / sub-package
from myproject.backend import huxley
```

### Naming Conventions

| Type | Public | Internal |
|---|---|---|
| Packages / Modules | `lower_with_under` | `_lower_with_under` |
| Classes / Exceptions | `CapWords` | `_CapWords` |
| Functions / Methods | `lower_with_under()` | `_lower_with_under()` |
| Constants | `CAPS_WITH_UNDER` | `_CAPS_WITH_UNDER` |
| Variables / Parameters | `lower_with_under` | `_lower_with_under` |

- **Avoid**: single-char names (except `i`, `j`, `e`, `f`), dashes in module names, `__dunder__` names for your own use, type names in variable names (`id_to_name_dict`)
- Files: `.py` extension only, no dashes

### Docstrings
Always use `"""triple-double-quotes"""`. Structure:

```python
def fetch_rows(
    table: Table,
    keys: Sequence[str],
    require_all: bool = False,
) -> Mapping[str, tuple]:
    """Fetches rows from a table.

    Args:
        table: An open Table instance.
        keys: Row keys to fetch.
        require_all: If True, only return rows with all keys set.

    Returns:
        A dict mapping keys to row data tuples.

    Raises:
        IOError: If table access fails.
    """
```

- **Modules**: one-line summary + overall description + typical usage example
- **Classes**: docstring below `class` line; document public attributes in `Attributes:` section
- **Properties**: use noun-style (`"""The Bigtable path."""`) not `"""Returns..."""`
- **`@override`**: docstring optional if decorator is present and behavior is unchanged

### TODO Comments
```python
# TODO: crbug.com/192795 - Investigate cpufreq optimizations.
```
Format: `# TODO: <link> - <explanation>`

### Type Annotation Style

```python
# Prefer X | None over Optional[X] (Python 3.10+)
def f(a: str | None = None) -> int | None: ...

# Use abstract container types
from collections.abc import Sequence, Mapping
def transform(items: Sequence[tuple[float, float]]) -> Mapping[str, int]: ...

# TypeVar with descriptive name
_T = TypeVar("_T")
AddableType = TypeVar("AddableType", int, float, str)
```

- Annotate `self`/`cls` only when using `Self`
- Use `TYPE_CHECKING` guard for imports only needed at type-check time
- Type aliases: `CapWords`, use `: TypeAlias` annotation (Python 3.10+)

### Functions & Classes
- **Function length**: prefer ~40 lines max; no hard limit, but split if it aids clarity
- **Getters/setters**: only when getting/setting involves non-trivial logic; otherwise make attribute public or use `@property`
- **`if __name__ == '__main__'`**: always required for executable modules; wrap logic in `main()`

---

## Quick Reference — Common Pitfalls

| ❌ Don't | ✅ Do |
|---|---|
| `except:` bare catch | `except SpecificError:` |
| `def f(a, b=[]):` | `def f(a, b=None): if b is None: b = []` |
| `if len(x) == 0:` | `if not x:` |
| `if x == None:` | `if x is None:` |
| `import jodie` (ambiguous) | `from package import jodie` |
| `logging.info(f'val={v}')` | `logging.info('val=%s', v)` |
| `result = a + b + c` (loop concat) | `''.join([a, b, c])` |
| `@staticmethod` | module-level function |

---

## Related Concepts
- [[71_Python_Snippets_MOC]] - Parent category
- [[71.01 Python 3.14 New Features]] - Language features referenced in annotations section
- [[71.03 FastAPI]] - Applies these conventions in API code
